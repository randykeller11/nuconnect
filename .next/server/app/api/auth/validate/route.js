(()=>{var e={};e.id=8313,e.ids=[8313],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},5486:e=>{"use strict";e.exports=require("bcrypt")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12209:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>w,routeModule:()=>d,serverHooks:()=>m,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>p});var s={};t.r(s),t.d(s,{POST:()=>l});var a=t(96559),n=t(48088),o=t(37719),i=t(32190),u=t(83243);async function l(e){try{let{userId:r}=await e.json();if(!r)return i.NextResponse.json({error:"Missing userId"},{status:400});let t=await u.I.getUserById(r);if(!t)return i.NextResponse.json({error:"User not found"},{status:404});let{password:s,...a}=t;return i.NextResponse.json(a)}catch(e){return console.error("Error validating user:",e),i.NextResponse.json({error:"Failed to validate user"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/validate/route",pathname:"/api/auth/validate",filename:"route",bundlePath:"app/api/auth/validate/route"},resolvedPagePath:"/Users/dub_ceo/Desktop/nuconnect/app/api/auth/validate/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:c,workUnitAsyncStorage:p,serverHooks:m}=d;function w(){return(0,o.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:p})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30615:(e,r,t)=>{"use strict";let{createClient:s}=t(93939);if(!process.env.SUPABASE_URL||!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY environment variables are required");let a=s(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY);class n{async createUser(e){try{let r;try{r=t(5486)}catch(e){console.log("bcrypt not found, using bcryptjs as fallback"),r=t(85665)}let s=await r.hash(e.password,10),{data:n,error:o}=await a.from("users").insert({email:e.email,password:s,first_name:e.firstName,last_name:e.lastName,phone:e.phone,relationship_status:e.relationshipStatus}).select().single();if(o)throw Error(`Supabase error: ${o.message}`);return{id:n.id,email:n.email,password:n.password,firstName:n.first_name,lastName:n.last_name,phone:n.phone,relationshipStatus:n.relationship_status,createdAt:new Date(n.created_at)}}catch(e){throw Error(`Failed to create user: ${e instanceof Error?e.message:"Unknown error"}`)}}async getUserByEmail(e){try{let{data:r,error:t}=await a.from("users").select("*").eq("email",e).single();if(t){if("PGRST116"===t.code)return null;throw Error(`Supabase error: ${t.message}`)}return{id:r.id,email:r.email,password:r.password,firstName:r.first_name,lastName:r.last_name,phone:r.phone,relationshipStatus:r.relationship_status,createdAt:new Date(r.created_at)}}catch(e){throw Error(`Failed to get user: ${e instanceof Error?e.message:"Unknown error"}`)}}async validateUser(e,r){try{let s,a=await this.getUserByEmail(e);if(!a)return null;try{s=t(5486)}catch(e){console.log("bcrypt not found, using bcryptjs as fallback"),s=t(85665)}return await s.compare(r,a.password)?a:null}catch(e){throw Error(`Failed to validate user: ${e instanceof Error?e.message:"Unknown error"}`)}}async getUserById(e){try{let{data:r,error:t}=await a.from("users").select("*").eq("id",e).single();if(t){if("PGRST116"===t.code)return null;throw Error(`Supabase error: ${t.message}`)}return{id:r.id,email:r.email,password:r.password,firstName:r.first_name,lastName:r.last_name,phone:r.phone,relationshipStatus:r.relationship_status,createdAt:new Date(r.created_at)}}catch(e){throw Error(`Failed to get user by ID: ${e instanceof Error?e.message:"Unknown error"}`)}}async createOrUpdateQuestionnaireResponse(e,r,t=!1){try{let{data:s,error:n}=await a.from("questionnaire_responses").select("*").eq("user_id",e).single();if(s){let{data:e,error:n}=await a.from("questionnaire_responses").update({answers:r,is_complete:t,updated_at:new Date().toISOString()}).eq("id",s.id).select().single();if(n)throw Error(`Supabase error: ${n.message}`);return{id:e.id,userId:e.user_id,answers:e.answers,isComplete:e.is_complete,submittedAt:new Date(e.submitted_at),updatedAt:new Date(e.updated_at)}}{let{data:s,error:n}=await a.from("questionnaire_responses").insert({user_id:e,answers:r,is_complete:t}).select().single();if(n)throw Error(`Supabase error: ${n.message}`);return{id:s.id,userId:s.user_id,answers:s.answers,isComplete:s.is_complete,submittedAt:new Date(s.submitted_at),updatedAt:new Date(s.updated_at)}}}catch(e){throw Error(`Failed to save questionnaire response: ${e instanceof Error?e.message:"Unknown error"}`)}}async getQuestionnaireResponseByUserId(e){try{let{data:r,error:t}=await a.from("questionnaire_responses").select("*").eq("user_id",e).single();if(t){if("PGRST116"===t.code)return null;throw Error(`Supabase error: ${t.message}`)}return{id:r.id,userId:r.user_id,answers:r.answers,isComplete:r.is_complete,submittedAt:new Date(r.submitted_at),updatedAt:new Date(r.updated_at)}}catch(e){throw Error(`Failed to get questionnaire response: ${e instanceof Error?e.message:"Unknown error"}`)}}async createQuestionnaireResponse(e){try{console.log("Attempting to insert questionnaire response:",e);let{data:r,error:t}=await a.from("questionnaire_responses").insert({user_id:e.userId,answers:e.answers}).select().single();if(t)throw console.error("Supabase error details:",{message:t.message,details:t.details,hint:t.hint,code:t.code}),Error(`Supabase error: ${t.message} (Code: ${t.code}, Details: ${t.details})`);return{id:r.id,userId:r.user_id,answers:r.answers,submittedAt:new Date(r.submitted_at)}}catch(e){throw console.error("Full error object:",e),Error(`Failed to create questionnaire response: ${e instanceof Error?e.message:"Unknown error"}`)}}async getAllQuestionnaireResponses(){try{let{data:e,error:r}=await a.from("questionnaire_responses").select("*").order("submitted_at",{ascending:!1});if(r)throw Error(`Supabase error: ${r.message}`);return(e||[]).map(e=>({id:e.id,userId:e.user_id,answers:e.answers,submittedAt:new Date(e.submitted_at)}))}catch(e){throw Error(`Failed to fetch questionnaire responses: ${e instanceof Error?e.message:"Unknown error"}`)}}async createProfessionalSignup(e){try{let{data:r,error:t}=await a.from("professional_signups").insert(e).select().single();if(t)throw Error(`Supabase error: ${t.message}`);return{id:r.id,name:r.name,firm:r.firm,email:r.email,phone:r.phone,specialty:r.specialty,submittedAt:new Date(r.submitted_at)}}catch(e){throw Error(`Failed to create professional signup: ${e instanceof Error?e.message:"Unknown error"}`)}}async getAllProfessionalSignups(){try{let{data:e,error:r}=await a.from("professional_signups").select("*").order("submitted_at",{ascending:!1});if(r)throw Error(`Supabase error: ${r.message}`);return(e||[]).map(e=>({id:e.id,name:e.name,firm:e.firm,email:e.email,phone:e.phone,specialty:e.specialty,submittedAt:new Date(e.submitted_at)}))}catch(e){throw Error(`Failed to fetch professional signups: ${e instanceof Error?e.message:"Unknown error"}`)}}async createContactSubmission(e){try{let{data:r,error:t}=await a.from("contact_submissions").insert({first_name:e.firstName,last_name:e.lastName,email:e.email,phone:e.phone,relationship_status:e.relationshipStatus,message:e.message}).select().single();if(t)throw Error(`Supabase error: ${t.message}`);return{id:r.id,firstName:r.first_name,lastName:r.last_name,email:r.email,phone:r.phone,relationshipStatus:r.relationship_status,message:r.message,submittedAt:new Date(r.submitted_at)}}catch(e){throw Error(`Failed to create contact submission: ${e instanceof Error?e.message:"Unknown error"}`)}}async getAllContactSubmissions(){try{let{data:e,error:r}=await a.from("contact_submissions").select("*").order("submitted_at",{ascending:!1});if(r)throw Error(`Supabase error: ${r.message}`);return(e||[]).map(e=>({id:e.id,firstName:e.first_name,lastName:e.last_name,email:e.email,phone:e.phone,relationshipStatus:e.relationship_status,message:e.message,submittedAt:new Date(e.submitted_at)}))}catch(e){throw Error(`Failed to fetch contact submissions: ${e instanceof Error?e.message:"Unknown error"}`)}}}e.exports={storage:new n,SupabaseStorage:n}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},83243:(e,r,t)=>{"use strict";t.d(r,{I:()=>s.storage});var s=t(30615)},93939:e=>{"use strict";e.exports=require("@supabase/supabase-js")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,580,5665],()=>t(12209));module.exports=s})();