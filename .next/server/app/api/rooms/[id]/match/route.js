(()=>{var e={};e.id=6090,e.ids=[6090],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74523:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>_,routeModule:()=>d,serverHooks:()=>g,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>m});var o={};t.r(o),t.d(o,{POST:()=>h});var s=t(96559),i=t(48088),n=t(37719),a=t(32190),p=t(93939);class u{calculateMatch(e,r,t=[]){let o=0,s=[],i=[],n=e.interests.filter(e=>r.interests.includes(e));o+=2*n.length,s.push(...n),n.length>0&&i.push(`shared interests in ${n.join(", ")}`);let a=this.calculateMentorshipCompatibility(e.mentorship_pref,r.mentorship_pref);o+=a,a>0&&("seeking"===e.mentorship_pref&&"offering"===r.mentorship_pref?i.push(`${r.name} offers mentorship in your areas of interest`):"offering"===e.mentorship_pref&&"seeking"===r.mentorship_pref?i.push(`you can mentor ${r.name} in their areas of interest`):("both"===e.mentorship_pref||"both"===r.mentorship_pref)&&i.push("mutual mentorship opportunity"));let p=this.calculateCareerGoalsCompatibility(e.career_goals,r.career_goals);o+=p,p>0&&("find-cofounder"===e.career_goals&&"find-cofounder"===r.career_goals?i.push("both seeking co-founders with complementary expertise"):"find-mentor"===e.career_goals&&"mentor-others"===r.career_goals?i.push("perfect mentor-mentee match"):"hire"===e.career_goals&&"explore-jobs"===r.career_goals&&i.push("hiring opportunity alignment"));let u=t.includes("priority_visibility");return u&&(o*=1.1),{profile:r,score:o,sharedTopics:s,explanation:i.length>0?`Great match! You both have ${i.join(" and ")}.`:"Potential connection based on your professional profiles.",hasPriorityBoost:u}}calculateMentorshipCompatibility(e,r){return e&&r?"seeking"===e&&"offering"===r||"offering"===e&&"seeking"===r?3:2*(("both"===e||"both"===r)&&"none"!==e&&"none"!==r):0}calculateCareerGoalsCompatibility(e,r){if(!e||!r)return 0;for(let[t,o]of[["find-cofounder","find-cofounder"],["find-mentor","mentor-others"],["mentor-others","find-mentor"],["hire","explore-jobs"],["explore-jobs","hire"],["investors","find-cofounder"],["find-cofounder","investors"]])if(e===t&&r===o||e===o&&r===t)return 4;for(let[t,o]of[["learn-ai","mentor-others"],["portfolio-feedback","mentor-others"],["hire","mentor-others"]])if(e===t&&r===o||e===o&&r===t)return 2;return 0}rankCandidates(e,r,t){let o=r.filter(r=>r.user_id!==e.user_id).map(r=>this.calculateMatch(e,r)).sort((e,r)=>e.hasPriorityBoost&&!r.hasPriorityBoost?-1:!e.hasPriorityBoost&&r.hasPriorityBoost?1:r.score-e.score),s=t.maxMatches||3,i=t.includeBoosts;return o.slice(0,i?s+2:s)}}let l=new u,c=(0,p.createClient)("https://estgdcessxwbpdcgpxsa.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function h(e,{params:r}){try{let{userId:t}=await e.json(),o=(await r).id;if(!t)return a.NextResponse.json({error:"Missing userId"},{status:400});let{data:s,error:i}=await c.from("profiles").select("*").eq("user_id",t).single();if(i||!s)return a.NextResponse.json({error:"User profile not found"},{status:404});let{data:n,error:p}=await c.from("room_members").select(`
        user_id,
        profiles (*)
      `).eq("room_id",o).neq("user_id",t);if(p)throw Error(`Failed to get room members: ${p.message}`);let u=n?.map(e=>e.profiles).filter(e=>null!==e).flat()||[],h=l.rankCandidates(s,u,{userId:t,maxMatches:3,includeBoosts:!1}),d=h.map(e=>({room_id:o,user_a:t,user_b:e.profile.user_id,match_score:e.score/10,shared_topics:e.sharedTopics,ai_explanation:e.explanation}));if(d.length>0){let{error:e}=await c.from("matches").upsert(d,{onConflict:"room_id,user_a,user_b"});e&&console.error("Error storing matches:",e)}return a.NextResponse.json({matches:h.map(e=>({id:`${t}-${e.profile.user_id}`,profile:e.profile,score:e.score,sharedTopics:e.sharedTopics,explanation:e.explanation,hasPriorityBoost:e.hasPriorityBoost}))})}catch(e){return console.error("Error generating matches:",e),a.NextResponse.json({error:"Failed to generate matches"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/rooms/[id]/match/route",pathname:"/api/rooms/[id]/match",filename:"route",bundlePath:"app/api/rooms/[id]/match/route"},resolvedPagePath:"/Users/dub_ceo/Desktop/nuconnect/app/api/rooms/[id]/match/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:f,workUnitAsyncStorage:m,serverHooks:g}=d;function _(){return(0,n.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:m})}},78335:()=>{},93939:e=>{"use strict";e.exports=require("@supabase/supabase-js")},96487:()=>{}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[4447,580],()=>t(74523));module.exports=o})();